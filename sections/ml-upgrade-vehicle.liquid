{% comment %}
  Section: Upgrades by Vehicle
  This section displays a slider of vehicles with a title, subheading, and icons.
{% endcomment %}

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<style>
  .upgrades-by-vehicle {
    /* padding: 50px 0; */
    text-align: center;
    position: relative; /* anchor for the floating SVG holder */
    {% if section.settings.background_image != blank %}
      background-image: url('{{ section.settings.background_image | image_url }}');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    {% endif %}
  }

  .upgrades-by-vehicle__header { margin-bottom: 40px; }

  .upgrades-by-vehicle__title-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
  }

  .upgrades-by-vehicle__title {
    font-size: 55px;
    font-weight: bold;
    margin: 0;
    text-transform: uppercase;
  }

  .upgrades-by-vehicle__icon { width: 30px; height: auto; }

  .upgrades-by-vehicle__subheading {
    font-size: 18px;
    color: #001429;
    margin: 0;
  }

  .upgrades-by-vehicle__grid-container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Swiper container styles */
  .vehicle-swiper {
    max-width: 1200px;
    margin: 0 auto;
    margin-top: 100px;
    padding: 0 20px;
    position: relative;
    overflow: visible;
  }

  .vehicle-swiper .swiper-slide {
    height: auto;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 60px;
  }

  .vehicle-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 20px;
    row-gap: 95px;
    max-width: 1015px;
    margin: 0 auto;
    margin-top: 150px;
    position: relative;
    justify-items: center;
  }

  .vehicle-card {
    height: 115px;
    width: 215px;
    border: 2px solid #001429;
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    background: #fff;
    position: relative;
    z-index: 2; /* above the SVG (z:0) */
  }

  .vehicle-card:hover {
    box-shadow: -5px 5px #001429;
    transform: translateY(-2px);
  }

  .vehicle-card__image {
    height: auto;
    margin-bottom: 15px;
    position: absolute;
    top: -85px;
    left: 0;
    right: 0;
    margin: auto;
    max-width: 190px;
    z-index: 3; /* keep above card and SVG */
  }

  .vehicle-card__title {
    font-size: 16px;
    font-weight: 900;
    color: #001429;
    margin: 0;
    position: relative;
    z-index: 3; /* keep above card and SVG */
  }

  .view-all-button-wrapper { margin-top: 40px; }

  .view-all-button {
    display: inline-block;
    padding: 12px 30px;
    border: 1px solid #000;
    border-radius: 30px;
    color: #000;
    text-decoration: none;
    font-weight: 600;
    transition: background-color 0.3s, color 0.3s;
  }

  .view-all-button:hover { background-color: #000; color: #fff; }

  /* --- Static SVG behind each card --- */
  .vehicle-card-wrapper {
    position: relative;
    display: grid;
    place-items: center;
  }

  .vehicle-card__svg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120%;
    height: 120%;
    pointer-events: none;
    z-index: 0; /* behind the card */
  }

  .vehicle-card__svg svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  .vehicle-card__svg path {
    fill: none;
    stroke: #001429;
    stroke-width: 3;
    stroke-linecap: round;
    stroke-linejoin: round;
    opacity: 0;
    stroke-dasharray: 1000;
    stroke-dashoffset: 1000;
    transition: opacity 0.3s ease, stroke-dashoffset 0.6s ease;
  }

  .vehicle-card-wrapper:hover .vehicle-card__svg path {
    opacity: 1;
    stroke-dashoffset: 0;
  }

  /* Swiper navigation styles */
  .vehicle-swiper .swiper-button-next,
  .vehicle-swiper .swiper-button-prev {
    color: #001429;
    background: rgba(255, 255, 255, 0.9);
    width: 50px;
    height: 50px;
    margin-top: -25px;
    border-radius: 50%;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border: 2px solid #001429;
    transition: all 0.3s ease;
  }

  .vehicle-swiper .swiper-button-next:hover,
  .vehicle-swiper .swiper-button-prev:hover {
    background: #001429;
    color: #fff;
    transform: scale(1.1);
  }

  .vehicle-swiper .swiper-button-next:after,
  .vehicle-swiper .swiper-button-prev:after {
    font-size: 18px;
    font-weight: bold;
  }

  /* Position navigation buttons */
  .vehicle-swiper .swiper-button-next {
    right: -25px;
  }

  .vehicle-swiper .swiper-button-prev {
    left: -25px;
  }

  .vehicle-swiper .swiper-pagination-bullet {
    background: #001429;
    opacity: 0.3;
  }

  .vehicle-swiper .swiper-pagination-bullet-active {
    opacity: 1;
  }

  /* Mobile pagination positioning */
  .vehicle-swiper .swiper-pagination {
    position: relative;
    margin-top: 30px;
    bottom: auto;
  }

  /* Responsive adjustments */
  @media (max-width: 1200px) {
    .vehicle-swiper .swiper-button-next {
      right: 10px;
    }

    .vehicle-swiper .swiper-button-prev {
      left: 10px;
    }

    .vehicle-swiper {
      overflow: hidden;
    }
  }

  @media (max-width: 768px) {
    .vehicle-swiper {
      margin-top: 100px;
      overflow: visible;
    }

    .vehicle-swiper .swiper-slide {
      margin-bottom: 60px; /* Increased for image space */
      padding-top: 70px; /* Add padding to prevent image cutoff */
    }

    /* Adjust vehicle card for tablet */
    .vehicle-card {
      height: 120px;
      width: 210px;
      margin: 0 auto;
    }

    /* Adjust image positioning for tablet */
    .vehicle-card__image {
      top: -80px; /* Slightly reduced */
      max-width: 170px; /* Slightly smaller */
      left: 50%;
      transform: translateX(-50%);
      right: auto;
    }

    .vehicle-swiper .swiper-button-next,
    .vehicle-swiper .swiper-button-prev {
      width: 40px;
      height: 40px;
      margin-top: -20px;
    }

    .vehicle-swiper .swiper-button-next {
      right: 5px;
    }

    .vehicle-swiper .swiper-button-prev {
      left: 5px;
    }

    .vehicle-swiper .swiper-pagination {
      margin-top: 40px;
    }

    .upgrades-by-vehicle__title {
      font-size: 24px;
    }
  }

  @media (max-width: 480px) {
    .vehicle-swiper {
      margin-top: 10px;
      padding: 0 20px;
      overflow: visible;
    }

    .vehicle-swiper .swiper-slide {
      margin-bottom: 60px; /* Increased to accommodate image overflow */
      padding-top: 80px; /* Add padding to prevent image cutoff */
    }

    /* Adjust vehicle card for mobile */
    .vehicle-card {
      height: 120px;
      width: 200px;
      margin: 0 auto;
    }

    /* Fix image positioning for mobile */
    .vehicle-card__image {
      top: -75px; /* Reduced from -85px */
      max-width: 160px; /* Slightly smaller for mobile */
      left: 50%;
      transform: translateX(-50%);
      right: auto;
    }

    /* Show navigation on mobile but smaller */
    .vehicle-swiper .swiper-button-next,
    .vehicle-swiper .swiper-button-prev {
      width: 35px;
      height: 35px;
      margin-top: -17px;
      display: flex;
    }

    .vehicle-swiper .swiper-button-next:after,
    .vehicle-swiper .swiper-button-prev:after {
      font-size: 14px;
    }

    .vehicle-swiper .swiper-pagination {
      margin-top: 30px;
    }

    .upgrades-by-vehicle__title {
      font-size: 20px;
    }
  }
</style>

<div class="upgrades-by-vehicle" data-section-id="{{ section.id }}">
  <div class="upgrades-by-vehicle__header">
    <div class="upgrades-by-vehicle__title-wrapper">
      {% if section.settings.left_icon != blank %}
        {{ section.settings.left_icon | image_url: width: 30 | image_tag: class: 'upgrades-by-vehicle__icon' }}
      {% endif %}
      <h2 class="upgrades-by-vehicle__title">{{ section.settings.title }}</h2>
      {% if section.settings.right_icon != blank %}
        {{ section.settings.right_icon | image_url: width: 30 | image_tag: class: 'upgrades-by-vehicle__icon' }}
      {% endif %}
    </div>
    {% if section.settings.subheading != blank %}
      <p class="upgrades-by-vehicle__subheading">{{ section.settings.subheading }}</p>
    {% endif %}
  </div>

  <div class="upgrades-by-vehicle__grid-container">
    <div class="vehicle-swiper swiper">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          <div class="swiper-slide">
            <div class="vehicle-card-wrapper">
              <div class="vehicle-card__svg">
                <svg viewBox="0 0 255 123" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
                  <g transform="translate(-202.000000, -621.000000)">
                    <path d="M312.746942,635.665667 C342.795755,635.665667 375.470718,641.874839 402.954847,654.421766 C416.593426,660.647987 463.681881,688.842028 452.732938,710.684109 C448.31537,719.496729 431.51489,724.593355 423.521058,727.249019 C405.798351,733.136752 387.332026,736.758403 368.836609,739.086201 C349.245671,741.55188 329.886077,741.634649 310.180631,741.634649 C292.389277,741.772182 274.702257,738.728513 258.062494,732.345914 C235.229245,723.58765 191.996533,692.240765 212.255932,662.251693 C233.170218,631.293221 306.497162,621.021193 340.559557,623.102058 C369.728418,624.883978 439.625909,645.054895 444.325442,680.638624 C445.728867,691.26502 442.74171,700.834782 434.738991,708.135661 C406.670607,733.742444 340.753995,727.612232 305.738711,727.612232 C285.150548,727.426236 264.579746,724.714287 244.510468,720.151473 C210.20282,712.351521 184.271563,693.90334 222.539037,666.258949 C273.719197,629.286445 352.102877,620.558956 411.838688,637.850902 C435.325989,644.649857 461.201224,658.041509 453.667766,685.920104"/>
                  </g>
                </svg>
              </div>
              <div class="vehicle-card" tabindex="0">
                {% if block.settings.vehicle_image != blank %}
                  {{ block.settings.vehicle_image | image_url: width: 200 | image_tag: class: 'vehicle-card__image', loading: 'lazy' }}
                {% else %}
                  {{ 'image' | placeholder_svg_tag: 'placeholder-svg vehicle-card__image' }}
                {% endif %}
                <p class="vehicle-card__title">{{ block.settings.vehicle_title }}</p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Navigation buttons -->
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>

      <!-- Pagination -->
      <div class="swiper-pagination"></div>
    </div>
  </div>

  {% if section.settings.button_label != blank and section.settings.button_link != blank %}
    <div class="view-all-button-wrapper">
      <a href="{{ section.settings.button_link }}" class="view-all-button">
        {{ section.settings.button_label }}
      </a>
    </div>
  {% endif %}

</div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Swiper for vehicle cards
    const vehicleSwiper = new Swiper('.vehicle-swiper', {
      // Default: 1 column, 2 rows for mobile/tablet vertical stacking
      slidesPerView: 1,
      spaceBetween: 20,
      grid: {
        rows: 2,
        fill: 'row'
      },

      // Navigation arrows
      navigation: {
        nextEl: '.vehicle-swiper .swiper-button-next',
        prevEl: '.vehicle-swiper .swiper-button-prev',
      },

      // Pagination
      pagination: {
        el: '.vehicle-swiper .swiper-pagination',
        clickable: true,
        dynamicBullets: true,
      },

      // Responsive breakpoints
      breakpoints: {
        // Mobile: 1 column, 2 rows (2 cards stacked vertically)
        320: {
          slidesPerView: 1,
          grid: {
            rows: 2
          },
          spaceBetween: 20,
          centeredSlides: true,
          navigation: {
            enabled: true
          }
        },

        // Tablet: 1 column, 2 rows (2 cards stacked vertically)
        768: {
          slidesPerView: 1,
          grid: {
            rows: 2
          },
          spaceBetween: 30,
          centeredSlides: true,
          navigation: {
            enabled: true
          }
        },

        // Desktop - 4x2 grid
        1024: {
          slidesPerView: 4,
          grid: {
            rows: 2
          },
          spaceBetween: 50,
          centeredSlides: false,
          navigation: {
            enabled: true
          }
        }
      },

      // Auto height
      autoHeight: false,

      // Disable loop for finite swiping
      loop: false,

      // Keyboard navigation
      keyboard: {
        enabled: true,
      },

      // Touch settings
      touchRatio: 1,
      touchAngle: 45,
      grabCursor: true,

      // Observer to watch for DOM changes (when blocks are added/removed)
      observer: true,
      observeParents: true,
      observeSlideChildren: true,
    });

    // Function to update Swiper when content changes
    function updateVehicleSwiper() {
      if (vehicleSwiper) {
        vehicleSwiper.update();
        vehicleSwiper.updateSlides();
        vehicleSwiper.updateProgress();
        vehicleSwiper.updateSlidesClasses();
      }
    }

    // // Listen for section reloads (Shopify theme editor)
    // document.addEventListener('shopify:section:load', function(event) {
    //   if (event.detail.sectionId === '{{ section.id }}') {
    //     setTimeout(updateVehicleSwiper, 100);
    //   }
    // });

    // // Listen for block additions/removals
    // document.addEventListener('shopify:block:select', updateVehicleSwiper);
    // document.addEventListener('shopify:block:deselect', updateVehicleSwiper);
  });
</script>

{% schema %}
{
  "name": "Upgrades by Vehicle",
  "settings": [
    { "type": "text", "id": "title", "label": "Title", "default": "Upgrades by Vehicle" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Parts for the most popular brands" },
    { "type": "image_picker", "id": "left_icon", "label": "Left Icon" },
    { "type": "image_picker", "id": "right_icon", "label": "Right Icon" },
    { "type": "image_picker", "id": "background_image", "label": "Background Image" },
    { "type": "text", "id": "button_label", "label": "Button Label", "default": "View All Vehicles" },
    { "type": "url", "id": "button_link", "label": "Button Link" }
  ],
  "blocks": [
    {
      "type": "vehicle",
      "name": "Vehicle",
      "settings": [
        { "type": "image_picker", "id": "vehicle_image", "label": "Vehicle Image" },
        { "type": "text", "id": "vehicle_title", "label": "Vehicle Title", "default": "Vehicle Name" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Upgrades by Vehicle",
      "blocks": [
        { "type": "vehicle" }, { "type": "vehicle" }, { "type": "vehicle" }, { "type": "vehicle" },
        { "type": "vehicle" }, { "type": "vehicle" }, { "type": "vehicle" }, { "type": "vehicle" }
      ]
    }
  ]
}
{% endschema %}
